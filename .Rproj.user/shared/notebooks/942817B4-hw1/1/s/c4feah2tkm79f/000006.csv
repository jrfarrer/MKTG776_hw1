"0","results <-"
"0","  customer_data %>% "
"0","  gather(customer_type, number_alive, -Year) %>%"
"0","  rename(year = Year) %>%"
"0","  mutate(calibration = 'Actual') %>%"
"0","  select(customer_type, calibration, year, number_alive)"
"0","param_history <- data_frame()"
"0","for(customer_type in c('Regular','High End')) {"
"0","  for(calibration in c(7, 10)) {"
"0","    "
"0","    mutate_call <- lazyeval::interp(~ a /1000, a = as.name(customer_type))"
"0","    "
"0","    percent_alive <- "
"0","      (customer_data %>% "
"0","         mutate_(.dots = setNames(list(mutate_call), ""percent_alive"")) %>% "
"0","         filter(Year >= 1 & Year <= calibration))$percent_alive"
"0","    "
"0","    params <- optim(par = c(1,1), fn_max_ll, gr = NULL, percent_alive)"
"0","    predicted <- fn_sGB_predict(alpha = params$par[1], beta = params$par[2], last_period = 12)"
"0","    "
"0","    param_history <- "
"0","      param_history %>%"
"0","      bind_rows("
"0","        data_frame("
"0","           customer_type = customer_type"
"0","              , calibration = paste0(calibration,""-period"")"
"0","              , alpha = params$par[1]"
"0","              , beta = params$par[2]"
"0","        )"
"0","      )"
"0","      "
"0","    "
"0","    results <-"
"0","      results %>%"
"0","      bind_rows("
"0","        data_frame("
"0","              customer_type = customer_type"
"0","              , calibration = paste0(calibration,""-period"")"
"0","              , year = 0"
"0","              , number_alive = 1000"
"0","            )"
"0","      ) %>%"
"0","      bind_rows("
"0","            data_frame("
"0","              customer_type = customer_type"
"0","              , calibration = paste0(calibration,""-period"")"
"0","              , year = 1:12"
"0","              , number_alive = predicted * 1000"
"0","            )"
"0","      )"
"0","  }"
"0","}"
